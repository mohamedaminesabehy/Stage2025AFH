<div class="performance-analytics" *ngIf="data">
  
  <!-- Score global de performance -->
  <div class="performance-header">
    <mat-card class="score-card">
      <mat-card-content>
        <div class="score-display">
          <div class="score-icon" [ngClass]="getScoreColor(data.scoreGlobal)">
            <mat-icon>{{getScoreIcon(data.scoreGlobal)}}</mat-icon>
          </div>
          <div class="score-info">
            <h2 class="score-value">{{data.scoreGlobal | number:'1.1-1'}}</h2>
            <p class="score-label">Score Global de Performance</p>
          </div>
        </div>
        <div class="score-progress">
          <mat-progress-bar 
            mode="determinate" 
            [value]="data.scoreGlobal"
            [color]="getScoreColor(data.scoreGlobal)">
          </mat-progress-bar>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="exportPerformanceReport()">
        <mat-icon>download</mat-icon>
        Exporter Rapport
      </button>
    </div>
  </div>

  <!-- Indicateurs de performance -->
  <div class="indicators-section">
    <mat-card class="indicators-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>dashboard</mat-icon>
          Indicateurs de Performance
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="indicators-grid">
          <div class="indicator-item" *ngFor="let indicateur of data.indicateurs">
            <div class="indicator-header">
              <span class="indicator-name">{{indicateur.nom}}</span>
              <span class="indicator-trend" [ngClass]="getTrendColor(indicateur.tendance)">
                <mat-icon>{{getTrendIcon(indicateur.tendance)}}</mat-icon>
              </span>
            </div>
            
            <div class="indicator-values">
              <span class="current-value">{{indicateur.valeur | number:'1.1-1'}} {{indicateur.unite}}</span>
              <span class="target-value">/ {{indicateur.objectif | number:'1.1-1'}} {{indicateur.unite}}</span>
            </div>
            
            <div class="indicator-progress">
              <mat-progress-bar 
                mode="determinate" 
                [value]="getIndicatorProgress(indicateur)"
                [color]="getIndicatorColor(indicateur)">
              </mat-progress-bar>
              <span class="progress-percentage">
                {{getIndicatorProgress(indicateur) | number:'1.0-0'}}%
              </span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Graphiques de performance -->
  <div class="charts-section">
    
    <!-- Graphique radar -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>radar</mat-icon>
          Vue Radar Performance
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
                  [data]="chartData.performanceRadar"
                  [options]="chartOptions"
                  type="radar">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Graphique en barres -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>bar_chart</mat-icon>
          Comparaison Objectifs
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
                  [data]="chartData.indicateursBar"
                  [options]="chartOptions"
                  type="bar">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Répartition des alertes -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>pie_chart</mat-icon>
          Répartition Alertes
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
                  [data]="chartData.alertesRepartition"
                  [options]="chartOptions"
                  type="doughnut">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Recommandations par impact -->
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>lightbulb</mat-icon>
          Recommandations par Impact
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
                  [data]="chartData.recommendationsImpact"
                  [options]="chartOptions"
                  type="pie">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>

  </div>

  <!-- Section Alertes et Recommandations -->
  <div class="alerts-recommendations-section">
    
    <!-- Alertes -->
    <mat-card class="alerts-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>warning</mat-icon>
          Alertes ({{filteredAlertes.length}})
        </mat-card-title>
        <div class="card-filters">
          <mat-form-field appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select [(value)]="selectedAlertType" (selectionChange)="onAlertFilterChange()">
              <mat-option value="all">Tous</mat-option>
              <mat-option value="error">Erreur</mat-option>
              <mat-option value="warning">Avertissement</mat-option>
              <mat-option value="info">Information</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Priorité</mat-label>
            <mat-select [(value)]="selectedPriority" (selectionChange)="onAlertFilterChange()">
              <mat-option value="all">Toutes</mat-option>
              <mat-option value="haute">Haute</mat-option>
              <mat-option value="moyenne">Moyenne</mat-option>
              <mat-option value="basse">Basse</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="alerts-list">
          <div class="alert-item" 
               *ngFor="let alerte of filteredAlertes" 
               [ngClass]="getAlertColor(alerte.type)">
            <div class="alert-icon">
              <mat-icon>{{getAlertIcon(alerte.type)}}</mat-icon>
            </div>
            <div class="alert-content">
              <h4 class="alert-title">{{alerte.titre}}</h4>
              <p class="alert-message">{{alerte.message}}</p>
              <div class="alert-meta">
                <span class="alert-time">{{formatTimeAgo(alerte.date)}}</span>
                <mat-chip class="priority-chip" [ngClass]="getPriorityColor(alerte.priorite)">
                  {{alerte.priorite}}
                </mat-chip>
              </div>
            </div>
            <div class="alert-actions">
              <button mat-icon-button (click)="dismissAlert(alerte)" matTooltip="Ignorer">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
          
          <div class="no-alerts" *ngIf="filteredAlertes.length === 0">
            <mat-icon>check_circle</mat-icon>
            <span>Aucune alerte correspondante</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Recommandations -->
    <mat-card class="recommendations-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>lightbulb</mat-icon>
          Recommandations ({{filteredRecommandations.length}})
        </mat-card-title>
        <div class="card-filters">
          <mat-form-field appearance="outline">
            <mat-label>Impact</mat-label>
            <mat-select [(value)]="selectedImpact" (selectionChange)="onRecommendationFilterChange()">
              <mat-option value="all">Tous</mat-option>
              <mat-option value="haute">Haute</mat-option>
              <mat-option value="moyenne">Moyenne</mat-option>
              <mat-option value="basse">Basse</mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field appearance="outline">
            <mat-label>Effort</mat-label>
            <mat-select [(value)]="selectedEffort" (selectionChange)="onRecommendationFilterChange()">
              <mat-option value="all">Tous</mat-option>
              <mat-option value="faible">Faible</mat-option>
              <mat-option value="moyen">Moyen</mat-option>
              <mat-option value="eleve">Élevé</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="recommendations-list">
          <div class="recommendation-item" *ngFor="let rec of filteredRecommandations">
            <div class="recommendation-header">
              <h4 class="recommendation-title">{{rec.titre}}</h4>
              <div class="recommendation-badges">
                <mat-chip class="impact-chip" [ngClass]="getImpactColor(rec.impact)">
                  Impact: {{rec.impact}}
                </mat-chip>
                <mat-chip class="effort-chip" [ngClass]="getEffortColor(rec.effort)">
                  Effort: {{rec.effort}}
                </mat-chip>
              </div>
            </div>
            
            <p class="recommendation-description">{{rec.description}}</p>
            
            <div class="recommendation-footer">
              <span class="recommendation-category">{{rec.categorie}}</span>
              <button mat-raised-button 
                      color="primary" 
                      (click)="implementRecommendation(rec)">
                <mat-icon>check</mat-icon>
                Implémenter
              </button>
            </div>
          </div>
          
          <div class="no-recommendations" *ngIf="filteredRecommandations.length === 0">
            <mat-icon>thumb_up</mat-icon>
            <span>Aucune recommandation correspondante</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

  </div>

</div>
